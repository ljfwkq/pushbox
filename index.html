<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8" />
		<title></title>
		<style>
			*{
				margin: 0;
				padding: 0;
				}
				#wrap{margin: 50px auto;position: relative;}
				.map0{width: 50px;height: 50px;background: dimgray;float: left;}/*灰色*/
				.map1{width: 50px;height: 50px;background: url(img/wall.png);float: left;}/*墙*/
				.map2{width: 50px;height: 50px;background: url(img/blue.png);float: left;}/*蓝区*/
				.map3{width: 50px;height: 50px;background: url(img/red.png);float: left;}/*红区*/
			    .box{width: 50px;height: 50px;background: url(img/box.png);float: left;position: absolute;}
			    .person{width: 50px;height: 50px;background: url(img/person.png);position: absolute;}
		</style>
	</head>
	<body>
		<div id="wrap"></div>
		<script type="text/javascript" src="js/jquery-1.11.3.min.js" ></script>
		<script>
		$(function(){
			Game.exe();
		});
			var Game={
			//执行
			exe:function(){
				this.map(0);
			},
			//关卡数据
			gk:[
			    //第一关
			    {
			    	map:[
			    	0,0,1,1,1,1,0,0,
			    	0,0,1,3,3,1,0,0,
			    	0,1,1,2,3,1,1,0,
			    	0,1,2,2,2,3,1,0,
			    	1,1,2,2,2,2,1,1,
			    	1,2,2,1,2,2,2,1,
			    	1,2,2,2,2,2,2,1,
			    	1,1,1,1,1,1,1,1
			    ],
			    //盒子宽高
			    size:[8,8],
			    //箱子的坐标
			    box:[
			        {x:4,y:3},
			        {x:3,y:4},
			        {x:4,y:5},
			        {x:5,y:5}
			    ],
			    person:[3,6]
			    
			    },
			    
			    //第二关
			    {
			    	map:[
			    	0,1,1,1,1,1,1,1,1,
			    	0,1,2,2,2,2,2,2,1,
			    	0,1,2,2,2,2,2,2,1,
			    	1,1,2,2,2,2,2,3,1,
			    	1,2,2,2,1,2,3,3,1,
			    	1,2,2,2,1,2,2,2,1,
			    	1,2,2,2,1,2,2,2,1,
			    	1,1,1,1,1,1,1,1,1
			    ],
			    //盒子宽高
			    size:[9,8],
			    //箱子的坐标
			    box:[
			        {x:2,y:4},
			        {x:3,y:3},
			        {x:5,y:4},
			    ],
			    person:[4,2]
			    
			    },
			    //第3关
				{
					//布局
					map:[
						1,2,2,2,2,2,2,2,1,
						1,2,0,0,3,3,3,2,1,
						1,2,0,0,0,2,2,2,2,
						2,2,2,0,0,0,0,0,2,
						2,0,0,0,2,0,2,0,2,
						2,0,0,0,2,0,0,0,2,
						2,0,0,0,2,2,2,2,2,
						2,2,2,2,2,1,1,1,1
					],
					//地图宽高
					size:[9,8],
					//箱子坐标
					box:[
						{x:3,y:3},
						{x:2,y:5},
						{x:5,y:4},
					],
					//人物坐标
					person:[3,1],
				},

				//第4关
				{
					//布局
					map:[
						2,2,2,2,2,2,2,2,1,
						2,0,0,0,3,3,3,2,1,
						2,0,0,0,0,2,2,2,2,
						2,2,0,2,0,0,0,0,2,
						2,0,0,2,2,0,2,0,2,
						2,0,0,0,0,0,0,0,2,
						2,0,0,0,2,2,2,2,2,
						2,2,2,2,2,1,1,1,1
					],
					//地图宽高
					size:[9,8],
					//箱子坐标
					box:[
						{x:2,y:3},
						{x:2,y:5},
						{x:5,y:4},
					],
					//人物坐标
					person:[3,1],
				},

				//第5关
				{
					//布局
					map:[
						2,2,2,2,2,1,1,1,1,
						2,0,0,0,2,1,1,1,1,
						2,0,0,0,2,1,2,2,2,
						2,0,0,0,2,1,2,3,2,
						2,2,2,0,2,2,2,3,2,
						1,2,2,0,0,0,0,3,2,
						1,2,0,0,0,2,0,0,2,
						1,2,0,0,0,2,2,2,2,
						1,2,2,2,2,2,1,1,1
					],
					//地图宽高
					size:[9,9],
					//箱子坐标
					box:[
						{x:2,y:2},
						{x:2,y:3},
						{x:3,y:2},
					],
					//人物坐标
					person:[1,1],
				},

				//第6关
				{	
					//布局
					map:[
						1,1,2,2,2,2,1,1,
						1,1,2,3,3,2,1,1,
						1,2,2,0,3,2,2,1,
						1,2,0,0,0,3,2,1,
						2,2,0,0,0,0,2,2,
						2,0,0,2,0,0,0,2,
						2,0,0,0,0,0,0,2,
						2,2,2,2,2,2,2,2
					],
					//地图宽高
					size:[8,8],
					//箱子坐标
					box:[
						{x:4,y:3},
						{x:3,y:4},
						{x:4,y:5},
						{x:5,y:5},
					],
					//人物坐标
					person:[3,6],
				},

				//第7关
				{	
					//布局
					map:[
						1,1,1,1,2,2,2,2,2,2,2,1,
						1,1,1,1,2,0,0,2,0,0,2,1,
						1,1,1,1,2,0,0,0,0,0,2,1,
						2,2,2,2,2,0,0,2,0,0,2,1,
						3,3,3,2,2,2,0,2,0,0,2,2,
						3,0,0,2,0,0,0,0,2,0,0,2,
						3,0,0,0,0,0,0,0,0,0,0,2,
						3,0,0,2,0,0,0,0,2,0,0,2,
						3,3,3,2,2,2,0,2,0,0,2,2,
						2,2,2,2,2,0,0,0,0,0,2,1,
						1,1,1,1,2,0,0,2,0,0,2,1,
						1,1,1,1,2,2,2,2,2,2,2,1
					],
					//地图宽高
					size:[12,12],
					//箱子坐标
					box:[
						{x : 5 , y : 6},
						{x : 6 , y : 3},
						{x : 6 , y : 5},
						{x : 6 , y : 7},
						{x : 6 , y : 9},
						{x : 7 , y : 2},
						{x : 8 , y : 2},
						{x : 9 , y : 6},
					],
					//人物坐标
					person:[5,9],
				}
			],
			//创建地图
			map:function(index){
				$("#wrap").empty();
				$("#wrap").css({
					width:this.gk[index].size[0]*50+'px',
					height:this.gk[index].size[1]*50+'px'
				});
				for(var i=0;i<this.gk[index].map.length;i++){
					$("#wrap").append('<div class="map'+this.gk[index].map[i]+'"></div>');
				}
				for(var i=0;i<this.gk[index].box.length;i++){
					$box=$('<div class="box"></div>');
					$("#wrap").append($box);
					$box.css({
						top:this.gk[index].box[i].y*50+"px",
						left:this.gk[index].box[i].x*50+"px"
					});
				}
					$person=$('<div class="person"></div>');
					$("#wrap").append($person);
					$person.css({
						top:this.gk[index].person[1]*50+"px",
						left:this.gk[index].person[0]*50+"px"
					});
					$person.data("x",this.gk[index].person[0]);
					$person.data("y",this.gk[index].person[1]);
					this.createPerson(index,$person,this);
			},
			//控制任务移动
			createPerson:function(index,$person,This){
				$(document).unbind("keydown");
				$(document).bind("keydown",(function(e){
					console.log("asd");
					switch(e.which){
						case 37://左
						$person.css('background-Position','-150px 0px');
							This.movePerson({x:-1},index,$person,This);
						break;
						case 38://上
						$person.css("background-position","0px,0px");
						This.movePerson({y:-1},index,$person,This);
						break;
						case 39://右
						$person.css("background-position","-50px,0px");
						This.movePerson({x:1},index,$person,This);
						break;
						case 40://下
						$person.css("background-position","-100px,0px");
						   This.movePerson({y:1},index,$person,This);
						break;
					}
				}));
			},
			movePerson:function(mJson,index,$person,This){
				var x=mJson.x||0;
				var y=mJson.y||0;
				if (  this.gk[index].map[($person.data('y')+y)*this.gk[index].size[0] +  $person.data('x')+x] != 1  ){
								$person.data('x',$person.data('x')+x);
								$person.data('y',$person.data('y')+y);
								$person.css({
									top:$person.data('y')*50+'px',
									left:$person.data('x')*50+'px'
								});
			    }
				$(".box").each(function(i){
					if(This.pz($person,$(this))&&This.gk[index].map[($person.data('y')+y)*This.gk[index].size[0] +  $person.data('x')+x] != 1){
						//撞上  非墙壁
						$(this).css(
							{top:($person.data('y')+y)*50+'px',
							left:($person.data('x')+x)*50+'px'
							}
						);
						$(".box").each(function(j){
							if(This.pz($(".box").eq(i),$(".box").eq(j))&&i!=j){
								$(".box").eq(i).css(
									{top:$person.data('y')*50+'px',
							        left:$person.data('x')*50+'px'
							        }
								);
								$person.data('x',$person.data('x')-x);
								$person.data('y',$person.data('y')-y);
								$person.css({
									top:$person.data('y')*50+'px',
									left:$person.data('x')*50+'px'
                                });
        							}
				});
					}else if(This.pz($person,$(this))&&This.gk[index].map[($person.data('y')+y)*This.gk[index].size[0] +  $person.data('x')+x] == 1 ){
						//撞上 是墙壁
							    $person.data('x',$person.data('x')-x);
								$person.data('y',$person.data('y')-y);
								$person.css({
									top:$person.data('y')*50+'px',
									left:$person.data('x')*50+'px'
                                });
					}
				});
				This.pass(This,index);
				This.changeBox(This,index);
			},
			//碰撞检测	
			pz:function(obj1,obj2){
				var t1=obj1.position().top;
				var b1=obj1.position().top+50;
				var l1=obj1.position().left;
				var r1=obj1.position().left+50;
				
				var t2=obj2.position().top;
				var b2=obj2.position().top+50;
				var l2=obj2.position().left;
				var r2=obj2.position().left+50;
				
				if(l2>=r1||r2<=l1||t2>=b1||b2<=t1){
					return false;
				}else{
					return true;
				}
			},
			//过关检测
			pass:function(This,index){
				var Num=0;
				$(".map3").each(function(i){
					$(".box").each(function(j){
					   if(This.pz($(".map3").eq(i),$(".box").eq(j))){
					   	   Num++;
					   }
					});
				});
				if(Num==$(".map3").size()){
					index++;
					This.map(index);
			    }
			},
			changeBox:function(This,index){
				$(".box").each(function(){
					var yy=$(this).position().top/50;
					var xx=$(this).position().left/50;
					if(This.gk[index].map[yy*This.gk[index].size[0]+xx]==3){
					$(this).css("background-Image","url(img/box2.png)");
				}else{
					$(this).css("background-Image","url(img/box.png)");
				}
				});
			}
		};
		</script>
	</body>
</html>
